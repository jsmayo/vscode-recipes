# Chrome Debugging with Angular CLI

by [Anthony Sneed (@tonysneed)](https://github.com/tonysneed)

This recipe demonstrates how to use the [Debugger for Chrome](https://github.com/Microsoft/vscode-chrome-debug) extension to debug VS Code applications generated by the [Angular CLI](https://cli.angular.io/) .

## Getting Started

- Make sure that [Google Chrome](https://www.google.com/chrome) is installed in the default location.

- Make sure the version number is **3.1.4** or greater of the [Debugger for Chrome](https://marketplace.visualstudio.com/items?itemName=msjsdiag.debugger-for-chrome) extension installed in VS Code.

- Use [NPM](https://www.npmjs.com) to install [Angular CLI](https://cli.angular.io) version **6.0** or greater globally.

  > **Please note**: Debugging may not function with other versions of Angular CLI.

    ```
    npm install -g @angular/cli@">=6.0"
    ```

- Use Angular CLI to create a new Angular application.

    ```
    ng new my-dream-app
    ```

- Change to the newly created application directory and open VS Code.

    ```
    cd my-dream-app
    code .
    ```

## Configure launch.json File

- Click on the Debugging icon in the Activity Bar to bring up the Debug view.
Then click on the gear icon to configure a launch.json file, selecting **Chrome** for the environment:

   ![add-chrome-debug](https://user-images.githubusercontent.com/2836367/27004175-77582668-4dca-11e7-9ce8-30ef3af64a36.png)

- Replace content of the generated launch.json with the following two configurations:

  ```json
  {
    "version": "0.2.0",
    "configurations": [
      {
        "name": "ng serve",
        "type": "chrome",
        "request": "launch",
        "url": "http://localhost:4200/#",
        "webRoot": "${workspaceFolder}"
      },
      {
        "name": "ng test",
        "type": "chrome",
        "request": "launch",
        "url": "http://localhost:9876/debug.html",
        "webRoot": "${workspaceFolder}"
      },
      {
        "name": "ng e2e",
        "type": "node",
        "request": "launch",
        "program": "${workspaceFolder}/node_modules/protractor/bin/protractor",
        "protocol": "inspector",
        "args": ["${workspaceFolder}/e2e/protractor.conf.js"]
      }
    ]
  }
  ```

  - Since `ng serve` also compiles the Angular application it can be used as a build task if you prefer the "PROBLEMS" tab to `Ctrl + click` in the terminal (for smaller screens you could open the terminal only when the status bar shows there are problems).
  
  Add the following `ng serve` task to your `tasks.json` file:
  
  ```json
  {
    "version": "2.0.0",
    "tasks": [
      {
        "identifier": "ng serve",
        "type": "npm",
        "script": "start",
        "group": {
          "kind": "build",
          "isDefault": true
        },
        "problemMatcher": {
          "owner": "typescript",
          "source": "ts",
          "applyTo": "closedDocuments",
          "fileLocation": [
            "relative",
            "${cwd}"
          ],
          "pattern": "$tsc",
          "background": {
            "activeOnStart": true,
            "beginsPattern": {
              "regexp": "Compiling...|TS\\d+:"
            },
            "endsPattern": {
              "regexp": "Compiled |Failed to compile."
            }
          }
        }
      },
    ]
  }
  ```

  ## Start Debugging

- Set a breakpoint in **app.component.ts** on the line that sets the `title` property of `AppComponent`.

- Open a terminal at the root folder and serve the app using Angular CLI:

  > **Please note**: Running `npm start` instead of `ng serve` ensures the app is served with the version of @angular/cli specified in package.json.

  ```
  npm start
  ```

- Go to the Debug view, select the **'ng serve'** configuration, then press F5 or click the green play button.

- The app will be shown in a browser, but in order to hit the breakpoint you'll need to *refresh* the browser.

![angular-breakpoint](https://user-images.githubusercontent.com/2836367/27004337-40bca8d8-4dcd-11e7-837e-b7602a3a622a.png)

## Debug Unit Tests

- Set a breakpoint in **app.component.spec.ts** on a line in one of the unit tests.

- Open a terminal at the root folder and run the tests using Angular CLI:

  > **Please note**: Running `npm run test` instead of `ng test` ensures tests are run with the version of @angular/cli specified in package.json.

  ```
  npm run test
  ```

- After the test run, go to the Debug view, select the **'ng test'** configuration, then press F5 or click the green button.

- When a browser opens with the test list, click the link for the test in which you placed the breakpoint. You should then hit the breakpoint:

![angular-test-breakpoint](https://user-images.githubusercontent.com/2836367/27004448-e5134ff8-4dce-11e7-8145-69de0956dd07.png)


## Debug End-to-end Tests

You can also debug your end-to-end tests running in Protractor with VS Code.

1. Start your local web server via `ng e2e`.

2. Set a breakpoint in **app.e2e-spec.ts** on a line in one of the end-to-end tests.

3. After the test run, go to the Debug view, select the **'ng e2e'** configuration, then press F5 or click the green button.

Notice: You might need to update the `"protocol"` property to `legacy` if you are using an older version of Node (older than Node 8)
